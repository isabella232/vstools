/***************************************************************************************************
 Copyright (C) 2023 The Qt Company Ltd.
 SPDX-License-Identifier: LicenseRef-Qt-Commercial OR LGPL-3.0-only OR GPL-2.0-only OR GPL-3.0-only
***************************************************************************************************/

//# using System.Threading.Tasks

var solution = Dte.Solution as Solution2;
var solutionBuild = solution.SolutionBuild as SolutionBuild2;

var taskRebuild = Task.Run(() =>
{
    solutionBuild.Clean(WaitForCleanToFinish: true);
    solutionBuild.Build(WaitForBuildToFinish: true);
});

bool buildOk = (taskRebuild.Wait(15000) && solutionBuild.LastBuildInfo == 0);
Result = buildOk ? MACRO_OK : MACRO_ERROR_MSG("Build failed.");
